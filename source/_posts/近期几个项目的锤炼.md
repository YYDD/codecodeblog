---
title: 近期几个项目的锤炼
date: 2016-11-06 13:48:40
tags:
---
啊咧~好久没有写文章了。好吧，给自己找个理由，因为这段时间一直很忙。恩~很忙~
9月份从0到1完整的完成了一个金融类的项目。而后马上加入了一个新的团队，一直在熟悉团队中原有项目的代码和业务逻辑。
那么久这两个项目，我觉得还是有不少的收获和启发的。

这里我主要想讲的是关于新团队的项目，是一个电商类的app。研究完整个项目之后，感觉还是有一些收获和想法的。

首先，不可否认，电商类的app的业务逻辑是复杂的。在没有接触电商类产品之前，我以为电商类的产品也就soso，但是真正接触了之后，才发现，好吧，我错了，真的是有够复杂的。虽然这么复杂，但是在我们程序员眼里，还是需要把需求一个个的拆分，把界面一个个的拆分，到最后全部变成一个个单一的简单的需求。

如何拆分呢？

那么我们就拿“某手淘”的首页来做例子吧。如果是我，我拿到类似界面，虽然给过来的是一个界面一整个完整的需求。但是一开始并不要急于开发，要分析需求。观察后发现这个复杂的界面，主要可以分为以下几个区块组成：

- banner
- 快速入口
- 新闻广告位
- 热门市场
- ...
<!--more-->
我简单的列出了类似的几个，当然它的首页完全不止这些。我们这里就简单的当做只有如此4个来处理。那么对于一个界面上由这样的4个区块组成。首先，我们应该想到，区块高度也许会调整，区块样式也许会改变，区块甚至也许会被替换……那么对于这样的种种，这时候就该考虑，怎么做才是最好的，也就是说到时候改起来对代码的伤害是最低的，最主要的是<b>我们程序员的伤害是最低的。</b>对于这样的区块，肯定是将他们单独抽离出来。这样做的灵活性是最高的。同时在单独处理单个区块的时候也应该考虑到一些基本的可变的需求。比如说banner是否可以支持多图，banner是否可以调转等……虽然有可能这样处理的方式会比较繁杂。但是其实如果面对以后的需求，就从容多了。而且这样处理的代码会显得非常的优雅。<b>我们如此高逼格的程序员，当然应该写出优雅的代码！</b>

其实放大的看，对于整个app的架构设计来说也是这样的。一开始一定要考虑清楚，如何设计，才能够面对需求不断改变的攻击。

作为一个多年奋战在iOS前线的老程序员（好像也没多少时间~），接下来分享一些有用的小tips：

- 尽可能的少用宏定义（`#Define`）
  ###### 过多的宏定义会增加编译时间。而且宏定义没有属性类型。即在使用过程中没法判断一个宏定义的常量是`string`类型的还是`int`类型的。相比较而言`static const`就好得多了。当然这个也是分情况的，一般情况下，`notification`比较适合用宏定义，因为`notification`会涉及到n个类，而且其实也并不关心是什么类型的常量，而其他情况的常量，不会像`notification`那样涉及到n个类的时候，并且会考虑常量的类型的时候，使用`static const`比较好。
  
- 尽量确保不要引用过多的文件（`#import`），在头文件中尽量使用（`@class`）
  ###### 如果引入过多的无用的头文件，会增加过多的编译时间。而且如果被引用的类废弃了删除了，则牵扯到的文件过多。有时候无法做依据error的数量来的判断是否应该废弃该类。在头文件中如果使用`#import`有时候会导致过多的引用，而出现编译错误。由此也印证了过多的引入头文件会增加编译时间。
  ###### 比较合理的用法：如果`.h`文件需要用到某个类，那么在头文件中使用`@class`，如果在`.m`文件中有涉及到某个类的具体实现，那么则在使用`#import`。这样做还可以不过多的暴露类。
  
- 能不用广播就不要使用广播（`NSNotification`）
  ###### 这个是我踩过的坑，当年年轻的时候，对网络请求做了二次封装，然后返回的结果全是用`notification`往上抛的。导致要debug的时候完全没办法，只能全文搜索字符串。。。因此，现在我能不使用`notification`就不使用`notification`。当然具体情况具体分析，因为有些场景还是`notification`最适合。比如app被挂起，app进入后台……
  
- 对于枚举的数据，尽量使用枚举型，不要直接数字表达
  ###### 这点，我相信不用过多的强调了，用枚举类型，就是可以将意思表达的更加清晰。

- 对于已经不再使用的文件不要长期的放置不理，不要出现过多的被注释的代码
  ###### 很多人也许会这么想，好不容易写出来的代码，不想轻易的删除，而且保不准哪天还是会用到的。对于这点，我认为是这样的，除非是当时耗时非常长，并且是非常优雅的代码那么我觉得可以用个分支或者自己直接单独copy出来，除此之外的我觉得都可以delete！因为本身自己是每天都在成长的，也许下一秒对于同一个需求你能够想出更加优雅的实现方式。所以下次如果还需要重新实现，大不了自己在来过。而且过多的没用的类，注释的代码。对于别人看你的代码会有极大的阻碍。当然还有一点，是我之前碰到过的。就是因为太多的注释了，根本无法判断这个注释是什么时候打的，有时候甚至还会恍惚到底是因为这个需求废弃了，还是因为我只是先打下注释，调下bug。已经完全分不清了。而且为了代码的整洁性，大胆的删吧！

- 实现文件(`.m`)文件尽量控制一定量的行数（比如500行？）
 ###### 其实控制代码的行数，这个只是其他的一些内容做了量化。比如这样就能够保证单个类里面，没有做过多的逻辑，能够把界面的实现和逻辑判断做分离，能够对一些通用的模块做抽离，等等。

- 方法，参数名尽可能的简单明了（宁可用拼音，也要保证简单明了）
 ###### 恩，这个为了大家好。

- 单个方法尽可能保证只做完成一件事情。
 ###### 这个，自己领悟吧~
 
- 不要修改引用的第三方库的源代码
 ###### 一方面是方便以后库的update，另一方面也是对作者的一种尊重吧，不随便改人家的代码。如果实在需要修改，我觉得可以使用`category`或者运用`kvc`等都是可以做到的。如果这样发大招之后，还是没办法满足需求的话，那么我觉得需要考虑下这个第三方库是否符合你的需求，是否应该换一个第三方库。

- 不要过分的相信后台返回的数据
 ###### 这一点，归功于我以前合作的伟大的后台程序员们，是不是给我来一下数据格式不按照协议文档返回。但是怎么说呢，因为移动客户端是直接面向用户的，如果用户碰到了卡死，或者crash等，用户肯定会觉得是这个app做的不好。那么这个锅，肯定得我们背。所以要做足撸棒性。
 
- 能有多不明显就多不明显的若若的告诉用户我正在加载（少用"菊花"）
 ###### “菊花”大家都知道是在loading。正因为他的醒目所以有时候会直接打断或者一定程度上影响用户操作的连贯性。所以有些地方可以静默加载，并不需要告诉用户我正在加载。除非是如果这个数据没有加载出来，会直接影响下一步操作，那么这时候可以考虑很明确的告诉用户。大家可以发现微信的加载基本上都是不打断用户操作的，当然除了打钱的时候，确实打钱输密码的时候也是印证了是我上面所说的，如果不完成这个操作会直接影响到下一步。

- 尽可能的消灭warnings
 ###### warning其实有时候也可以理解为是一个错误。应该尽可能的解决掉所有的warnings，提高代码质量。
 
- 如何优雅的选择一个第三方库
 ###### 对于选择第三方库，就我自己而言，首先当然最关注的是他的star数量，其次我会看他的提交时间，也就是说这个库，作者是否在更新。其实会关注下这个库的文档啊，提的issue啊什么的，这些都是判断一个库是否够“正规”，是否够强大。

- 未完待续……
###### 恩~现在只想到这么多。上面的有不少是我之前踩过的坑，还有一些是修行的感悟。。。

其实上面的不少tips并非是代码层面的，有些是用户体验方面的。因为我觉得做移动开发，要考虑的不仅仅是写出来的代码的性能多么的好，还需要考虑用户体验，有时候甚至我觉得用户体验由于代码性能。因为最终呈现给用户的是界面，而不是运行界面的几万行甚至几十万，几百万行的代码。

最后安利一本书，这本书介绍了51个tips吧。个人感觉，对于代码质量的提升，领悟还是满有用的。
[《Effective Objective-C 2.0  编写高质量iOS与OS X代码的52个有效方法》](http://vdisk.weibo.com/s/qOPFY0tDeUfa)


